name: Create Branch from Issue

on:
  issues:
    types: [labeled]

jobs:
  create_branch:
    runs-on: ubuntu-latest
    if: |
      contains(github.event.issue.labels.*.name, 'Feature') || 
      contains(github.event.issue.labels.*.name, 'Bug') || 
      contains(github.event.issue.labels.*.name, 'Hotfix') ||
      contains(github.event.issue.labels.*.name, 'Chore')
    steps:
      - name: Check out the repository
        uses: actions/checkout@v2

      - name: Set the branch prefix based on the issue label
        id: create_branch_name
        run: |
          # Obtém a primeira label e converte para minúsculas
          LABEL=$(echo "${{ github.event.issue.labels[0].name }}" | tr '[:upper:]' '[:lower:]')
          
          # Remove qualquer texto entre colchetes do título da issue
          ISSUE_TITLE=$(echo "${{ github.event.issue.title }}" | sed 's/\[.*\] //g' | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
          
          # Monta o nome da branch no formato correto
          BRANCH_NAME="${LABEL}/${ISSUE_TITLE}"
          
          echo "Branch name: $BRANCH_NAME"
          echo "::set-output name=branch_name::$BRANCH_NAME"

      - name: Create and push branch
        env:
          TOKEN: ${{ secrets.PUSH_TOKEN }}
        run: |
          git checkout -b ${{ steps.create_branch_name.outputs.branch_name }}
          git push https://x-access-token:${TOKEN}@github.com/${{ github.repository }} ${{ steps.create_branch_name.outputs.branch_name }}
